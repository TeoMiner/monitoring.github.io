<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống giám sát</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <script>
        const client = mqtt.connect('wss://broker.hivemq.com:8884/mqtt')
        client.on('connect', () => {
            console.log('Da ket noi toi esp')
            client.subscribe('Nhietdo')
            client.subscribe('Doam')
            client.subscribe('Cua')
            client.subcribe('reset')
        })
        client.on('message', (topic, message) => {
            if(topic == 'Nhietdo') 
            {
                document.getElementById('temp').textContent = message
                console.log(message.toString())
            }
            if(topic == 'Doam') 
            {
                document.getElementById('humid').textContent = message
                console.log(message.toString())
            }
            if(topic == 'Cua') 
            {
                document.getElementById('door').textContent = message
                console.log(message.toString())
            }
            if(topic == 'reset') 
            {
                location.reload();
            }
        })
    </script>
</head>
<body>
    <h1 style="text-align:center;">Hệ thông giám sát nhiệt độ và độ ẩm</h1>
    <div>
        <p style="display: inline;font-size: xx-large;">Nhiệt độ: <p id="temp" ; style="display: inline;font-size: xx-large;"></p><p style="display: inline;font-size: xx-large;">°C</p></p>
    </div>
    <p>
        Điều chỉnh nhiệt độ ngưỡng
        <div class="slidecontainer">
            <input type="range" min="-20" max="40" value="1" class="slider" id="nguong">
            <p><b>Giá trị ngưỡng: <span id="giatri"></span></b></p>
            <script>
        var slider = document.getElementById("nguong")
        var output = document.getElementById("giatri")
        let val = 0;
        output.innerHTML = slider.value
        slider.oninput = function()
        {
          output.innerHTML = this.value
          //console.log(this.value.toString())
          client.publish('giatringuong',this.value.toString())
          //client.publish('giatringuong',this.value.toString())
        }
            </script>
        </div>
    </p>
    <div>
        <p style="display: inline;font-size: xx-large;">Độ ẩm: <p id="humid" ; style="display: inline;font-size: xx-large;"></p><p style="display: inline;font-size: xx-large;">%</p></p>
    </div>
    <br>
    <div>
        <p style="display: inline;font-size: xx-large;">Cửa: <p id="door" ; style="display: inline;font-size: xx-large;"></p><p style="display: inline;font-size: xx-large;"></p></p>
    </div>
</body>
</html>
